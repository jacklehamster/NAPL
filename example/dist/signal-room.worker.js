function h({userId:N,room:z,host:Q,onOpen:q,onClose:A,onError:G,logLine:X,onPeerJoined:F,onPeerLeft:J,onMessage:M}){let v="wss://"+Q+"/room/"+z+"?userId="+encodeURIComponent(N),B=new WebSocket(v),$=!1;function U(Y,k,H){if($)return!1;let D={type:Y,to:k,payload:H};return B.send(JSON.stringify(D)),X?.("\uD83D\uDC64 ➡️ \uD83D\uDDA5️",D),!0}function W(Y){let k;try{k=JSON.parse(Y.data)}catch{X?.("⚠️ ERROR",{error:"invalid-json"});return}if(X?.("\uD83D\uDDA5️ ➡️ \uD83D\uDC64",k),k.type==="peer-joined"&&k.peerId&&k.userId){let{userId:H,peerId:D}=k;F({userId:H,peerId:D,receive:(Z,_)=>{return U(Z,D,_)}});return}if(k.type==="peer-left"&&k.peerId&&k.userId){let{userId:H,peerId:D}=k;J(H,D);return}if(k.peerId&&k.userId){let{userId:H,peerId:D}=k;M(k.type,k.payload,{userId:H,peerId:D,receive:(Z,_)=>{return U(Z,D,_)}})}}if(B.addEventListener("message",W),q)B.addEventListener("open",q);if(A)B.addEventListener("close",A);if(G)B.addEventListener("error",G);return{exitRoom:()=>{if($=!0,B.close(),B.removeEventListener("message",W),q)B.removeEventListener("open",q);if(A)B.removeEventListener("close",A);if(G)B.removeEventListener("error",G)}}}var V=null,T=new Map;function K(N){self.postMessage(N)}self.addEventListener("message",(N)=>{let z=N.data;if(console.debug("[signal-room.worker] received command",z),z.cmd==="enter"){V?.(),V=null,T.clear(),V=h({userId:z.userId,room:z.room,host:z.host,onOpen:()=>K({kind:"open"}),onClose:()=>K({kind:"close"}),onError:()=>K({kind:"error"}),logLine:(q,A)=>{console.debug(`[signal-room.worker] ${q}`,A),K({kind:"log",direction:q,obj:A})},onPeerJoined:(q)=>{T.set(q.peerId,q.receive),K({kind:"peer-joined",userId:q.userId,peerId:q.peerId})},onPeerLeft:(q,A)=>{T.delete(A),K({kind:"peer-left",userId:q,peerId:A})},onMessage:(q,A,G)=>{T.set(G.peerId,G.receive),K({kind:"message",type:q,payload:A,fromUserId:G.userId,fromPeerId:G.peerId})}}).exitRoom;return}if(z.cmd==="send"){let Q=T.get(z.toPeerId);if(Q)Q(z.type,z.payload);return}if(z.cmd==="exit"){V?.(),self.close();return}});

//# debugId=471744D4D65F41ED64756E2164756E21
//# sourceMappingURL=signal-room.worker.js.map
